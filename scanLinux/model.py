#!/usr/bin/env python

import pickle
# we have 41,323 legit files (exe,dlls)
# we have 96,724 malicious file downloaded from virusshare
import pandas as pd
# Use numpy to convert to arrays
import numpy as np

class Model:
	def __init__(self,dataset): 
		self.dataset = dataset
		# save the model to disk
		self.filename = 'finalized_model.sav'
		
	def start(self): 
		# load the model from disk
		loaded_model = pickle.load(open(self.filename, 'rb'))
		
		# load the model from disk
		f_select = pickle.load(open('scaler.pkl', 'rb'))
		
		#test our exctracted data
		dsa=pd.read_csv(self.dataset, sep= "|") 

		dropcolumns_t=dsa.drop(["Name", "md5", "legitimate"], axis=1).values
		#scale the dataaccording to the feature selector
		data_t= f_select.transform(dropcolumns_t)
		#convert the dataset to array form to be reconized by the model
		tes = np.array(data_t)
		#predict(classify) the data according to the label
		res= loaded_model.predict(tes)
		#for index r in value i in the returned list res (after prediction) do..
		print("OUR LEARNED MACHINE SAYS THAT:\n")
		for r,i in enumerate(res):
			if i == 0:
				print('THE FILE %s...................SEEMS MALICIOUS'%(dsa.loc[r][0]))
			elif i == 1:
				print('THE FILE %s...................LOOKS BENIGN'%(dsa.loc[r][0]))
		print("THANK YOU!")

				#print each file name (row r from culmn i in the datset name feature) .. 
				#print if it is malicious(0) or legitimate (1)
